<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Solitude - Happenings</title>
  <meta name="author" content="Solitude" />
  <meta name="twitter:widgets:csp" content="on" />
  <meta name="description" content="The blog of Solitude" />
  <link rel="canonical" href="http://solitude.vkps.co.uk/page/40/" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Solitude" href="http://solitude.vkps.co.uk/atom.xml" />

  <link rel="stylesheet" href="/solitude-jekyll/assets/css/all.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-k2/8zcNbxVIh5mnQ52A0r3a6jAgMGxFJFE2707UxGCk= sha512-ZV9KawG2Legkwp3nAlxLIVFudTauWuBpC10uEafMHYL0Sarrz5A7G79kXh5+5+woxQ5HM559XX2UZjMJ36Wplg==" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <h1><a href="/solitude-jekyll/">Solitude</a></h1>
  <a href="/">
    
    <img src="/solitude-jekyll/assets/images/tree-160.jpg" id="solitude-logo" alt="Solitude logo"/>
    
  </a>
  <div id="bio">
    <p>Technology. Code. Living relentlessly in the real world.</p>
  </div>
  <nav>
    <ul>
      <li><a href="/solitude-jekyll/about/">About</a></li>
      <li><a href="/solitude-jekyll/Archives/">Archives</a></li>
    </ul>
  </nav>
  <div id="social">
    Follow me:
<div id="stalker">
  

  

  

  

  

  
  <a title="garyfleming on Twitter" href="https://twitter.com/garyfleming">
    <i class="fa fa-twitter-square"></i>
  </a>
  

  

  

  

  

  

  
  <a title="Atom feed" id="atom" href="/feed/">
    <i class="fa fa-rss-square"></i>
  </a>
  
</div>

  </div>
  
</nav>

    </div>

    <div class="eleven columns content">
      <div id="home">
  <h2><i class="fa fa-bookmark"></i> Happenings</h2>

  
  <div class="postcontainer">
  <h3><a href="/solitude-jekyll/Archives/2009/01/13/data-mappers/">Data Mappers with Java</a></h1>
  <p class="author">
    <span class="date"> </span>
  </p>
  <div class="post">
    <p>In the Java world, there have been many ways to persist and retrieve domain objects, and most involve some form of ORM mapping. Modern methods include <a href="http://www.hibernate.org/">Hibernate</a>, <a href="http://ibatis.apache.org/">iBatis</a>, <a href="http://static.springframework.org/spring/docs/2.0.x/reference/jdbc.html">Spring JDBC Templates</a> and other <a href="http://java.sun.com/javaee/overview/faq/persistence.jsp">JPA providers</a>; these are all fine methods and all should be used appropriately. Most of the time you should use one of the above approaches and not what I’m going to show you below.</p>

<p>One thing I’d like to say about persistence in Java is that you should almost never be using raw JDBC. There’s too much boiler-plate and repetition. You need to create a <code class="highlighter-rouge">DataSource</code>, and then get a <code class="highlighter-rouge">Connection</code>, then use that <code class="highlighter-rouge">Connection</code> to get a <code class="highlighter-rouge">PreparedStatement</code>. That can start to look pretty messy.</p>

<p>Worst of all is that you get a <code class="highlighter-rouge">ResultSet</code> back which, if used without any form of conversion or mapping to your own domain, exposes the rest of your application to the persistence layer. This is bad for several reasons, not least of all it makes your code more tightly coupled and brittle in the face of change. Let’s be clear here: passing around a <code class="highlighter-rouge">ResultSet</code>, <code class="highlighter-rouge">CachedRowSet</code> or any other variant is <strong>BAD</strong>.</p>

<p>It’s easy to avoid this problem by convert between a ResultSet row and a domain-specific object. Spring popularised an idea called the RowMapper (which I’ll outline below). The idea is that you have an interface that, once implemented, will convert between a resultSet and your domain object.</p>

<p>Why might you need this? If you’re dealing with legacy applications, it’s frequently too costly to go back and retrofit one of the more modern approaches to ORM; the database layer doesn’t fit well with Hibernate, or the rest of the codebase won’t sit nicely with JPA, or you can’t take an (additional) external library dependency for any number of reasons. Sometimes it’s easier to quickly roll your own. Here’s an example I’ll call a <code class="highlighter-rouge">DataMapper</code> (NOTE: I’ve omitted Exception handling for the sake of clarity, you will need to add this back in!):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public interface DataMapper&lt;T&gt; {

	public T mapRow(ResultSet resultSet);

}
</code></pre>
</div>

<p>That’s nice and simple. When you implement this interface, your implementation doesn’t bother with any sort of row iteration, all it does is take the current row of the <code class="highlighter-rouge">resultSet</code>, call the standard <code class="highlighter-rouge">getString(...)</code> etc methods and builds up a single one of your beans, here represented by the generic placeholder <code class="highlighter-rouge">T</code>. Elsewhere you have this partner method (I like to keep this as a statically imported utility):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public static &lt;T&gt; Collection&lt;T&gt; map(ResultSet resultSet, DataMapper&lt;T&gt; mapper) {
    Collection&lt;T&gt; mappedObjects = new LinkedList&lt;T&gt;();
    while(resultSet.next() {
        mappedObjects.add(mapper.mapRow(resultSet));
    }
    return mappedObjects;
}
</code></pre>
</div>

<p>This method takes care of the iteration. You pass it your resultSet, and a DataMapper implementation and it’ll give you back a collection of your domain objects. Still quite simple and neat.</p>

<p>How about an example? Let’s say you have a ResultSet that could be mapped to a simple Person bean:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public class Person {

    private String firstName;
    private String lastName;
    private int age;

    //getters and setters for the above fields are omitted
    //Imagine they were below. Go on, it'll make life easier.

}
</code></pre>
</div>

<p>To do this using the DataMapper code I’ve outlined above, you’d have something like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>public class PersonMapper implements DataMapper&lt;Person&gt; {

    @Override
    public Person mapRow(ResultSet resultSet) {
        Person bean = new Person();
        bean.setFirstName(resultSet.getString("first_name"));
        bean.setLastName(resultSet.getString("last_name"));
        bean.setAge(resultSet.getInt("age"));
        return bean;
    }

}
</code></pre>
</div>

<p>Pass that to the map method along with a valid ResultSet and you’ll get out a Collection of Person beans to work with. We’ve gone from ResultSet to domain-specific in very little code.</p>

<p>Now these DataMappers don’t have to be simple. They could use the ResultSet and only the ResultSet, or they could use that as a basis to do more queries to build the object. They could lookup other services for information. They can do whatever you want for a relatively high power-to-lines of code ratio.</p>

<p>I’ve found myself using the DataMapper abstraction for the purposes of unit testing. You write a DataMapper that outright ignores the (perhaps empty) ResultSet you pass it, and it instead uses the some randomised test data you’ve got ready. You can now easily create test beans without relying on the DB layer.</p>

<p>It’s not perfect, and there are often better ways of doing persistence, but I’ve found this pattern has been very useful on a number of occasions.</p>

  </div>
  <div class="divider"><img src="/solitude-jekyll/assets/images/divider.png" /></div>
  </div>
  
  <div class="postcontainer">
  <h3><a href="/solitude-jekyll/Archives/2009/01/10/six-years-of-solitude/">Six Years of Solitude</a></h1>
  <p class="author">
    <span class="date"> </span>
  </p>
  <div class="post">
    <p>So, as of the publishing date of this piece, Solitude will have been around and active for six years. It seems like a long time. Going back and looking over the first few entries is, as one might expect, cringe-inducing.</p>

<p>There’s the <a href="/Archives/2003/01/10/NewSiteSoon/">very first post</a> (which promised the now long-defunct main VKPS site would be back soon – HA!) and <a href="/Archives/2003/01/11/RealConnections/">first real update</a> about Geolocation (which hasn’t really done much of any use, though we’ll see if <a href="http://labs.mozilla.com/2008/10/introducing-geode/">Geode</a> changes that), and the first film review (for <a href="/Archives/2003/01/28/TheTuxedo/">The Tuxedo</a>), and even the first first recipe (I remember how bad that <a href="/Archives/2003/01/17/Omlette/">omlette</a> was, it was all shell).</p>

<p>Even though my post rate has dropped over the years, I hope that Solitude or a successor will still be here in another six years, to give me pleasant memories to wince over.</p>

  </div>
  <div class="divider"><img src="/solitude-jekyll/assets/images/divider.png" /></div>
  </div>
  
  <div class="postcontainer">
  <h3><a href="/solitude-jekyll/Archives/2009/01/07/neater-excel-in-java/">Neater Excel in Java</a></h1>
  <p class="author">
    <span class="date"> </span>
  </p>
  <div class="post">
    <p>If you write applications or websites using Java, you’ve probably needed to export some data to Excel at some point or other. It’s pretty well accepted that the best library for this is the invaluable <a href="http://poi.apache.org/">POI</a>. It provides a neat wrapper over most Excel functionality. It lets you create or reference a spreadsheet (an <code class="highlighter-rouge">HSSFWorkbook</code> in POI terms), and then gives you object abstractations for just about any way you might want to manipulate that. Cell styles, formulas, drawing shapes… I won’t go into everything but the <a href="http://poi.apache.org/spreadsheet/quick-guide.html" title="Example code for POI">cook book</a> is a pretty good starting point for any work you might be doing.</p>

<p>The one thing that’s always bothered me about POI is that it’s pretty low-level, you have to manage absolutely every aspect of what you’re doing. Now it’s great to be able to access that kind of power, but an abstraction over the top would be good.</p>

<p>That’s where <a href="http://jxls.sourceforge.net/">jXLS</a> comes in. It builds on top of POI to provide a templating approach to writing new Excel documents, a decent abstraction for most purposes.</p>

<p>Rather than managing everything from what can quickly become fairly complex Java code, you create a template excel file that contains placeholders for where your data should appear. It’s smart enough to be able to intelligently expand a collection of beans and create a new row for each one. That can reduce your boilerplate code significantly.</p>

<p>Downsides? The documentation isn’t the best, and the expression language for some of the more advanced uses is <a href="http://commons.apache.org/jexl/">JEXL</a>, which is pretty horrible. Those, however, aren’t major concerns. You’ll rarely need either in depth and, if in doubt, you can always drop down to the POI APIs anyway.</p>

<p>Now, it’s not to be used in all circumstances, there are still situations that are a little beyond it, but it’s an extremely good 80/20 API (you get 80% of the use cases made easy, and the other 20% are still possible). Definitely worth a look.</p>

  </div>
  <div class="divider"><img src="/solitude-jekyll/assets/images/divider.png" /></div>
  </div>
  
  <div class="postcontainer">
  <h3><a href="/solitude-jekyll/Archives/2009/01/05/film-fight-2009/">Film Fight 2009</a></h1>
  <p class="author">
    <span class="date"> </span>
  </p>
  <div class="post">
    <p>After failing dismally in the early parts of last year, I’m going to be giving <a href="/Archives/2008/01/15/film-fight-2008/">twittering Film Fight</a> another chance (on <a href="http://twitter.com/garyfleming">my twitter feed</a>). For anyone who didn’t see it last year, I’ll be writing film reviews before the later (and often delayed) monthly Film Fights with little snippets on twitter. Often this gives a slightly different perspective of the film, with less time for memory and external bias to change what I thought of the film.</p>

<p>I’m tempted to update twitter and not refer back to it for the film fight, so I can do a comparision of what I thought immediately and what I’m thinking now. We’ll see if that ever actually happens.</p>

<p>If you want to read the 2009 reviews but not the rest of my Twitter (which is occassionally more personal than Solitude), then use the <a href="http://search.twitter.com/search?q=%23FF09+from%3Agaryfleming">Film Fight ’09 Twitter Search page</a>.</p>

<p>Let’s hope I get a little further into this year than last.</p>

  </div>
  <div class="divider"><img src="/solitude-jekyll/assets/images/divider.png" /></div>
  </div>
  
  <div class="postcontainer">
  <h3><a href="/solitude-jekyll/Archives/2009/01/02/solitude-awards-2008/">Solitude Awards 2008</a></h1>
  <p class="author">
    <span class="date"> </span>
  </p>
  <div class="post">
    <p>As has become tradition (see <a href="/Archives/2008/01/09/solitude-awards-2007/" title="Solitude Awards 2007">last year</a>), it’s time for the best of 2008 awards here at sunny Solitude:</p>

<ul>
  <li><strong>Best album of 2008</strong> – I was struggling to come up with anything for this, mostly because I can’t really remember what I’ve gotten this year. Thankfully, <a href="http://www.last.fm/user/VKPS">my last.fm profile</a> is handy for these things, once you mine past all the great older stuff I’ve been listening to. I think the best new album I got from this year is “West Texas” by <a href="http://www.myspace.com/sleepercarwesttexas">Sleepercar</a>. Formed as a side-project to Sparta, Jim Ward makes Alt. Rock and Country sit tidily, side by side. A pleasant listen.</li>
  <li><strong>Saddest band break-up of 2008</strong> – It’s been a bad year for fans of modern rock, having lost the joint winners of this award. <a href="http://wordsfromreuben.com/">Reuben</a> and <a href="http://www.hellisforheroes.net/">Hell is for Heroes</a> have both called it a day. Both bands were known for excellent live performances, solid albums and a great ethic. They’ll be sadly missed.</li>
  <li><strong>Most disappointing no-show album of 2008</strong> – Overdue by quite some time, “Pandemonium Duke”, is the second album by Marmaduke Duke (made up of Biffy Clyro and Sucioperro members). We heard the first sampler well over 18 months ago and this record has been sitting on the shelves for quite some time. The plus side is that it now looks to be moving (first single is due out in February) and on a major label. Good times ahead for the Duke.</li>
  <li><strong>Best use of William Fichtner 2008</strong> – While it would be easy to pick his ongoing role as Alex Mahone in Prison Break as his best use, I think we can do better. In the opening sequence for The Dark Knight, the joker and his goons rob a bank that is run by gangsters. The branch manager comes out wielding a shotgun and generally kicking ass. Who was it? Yeah, William Fichtner. Take that, Prison Break.</li>
  <li><strong>Best novel I read this year</strong> – I’m going to stretch this category a little (but only as far as others have before) and say the best novel I read this year was Watchmen. A densely plotted, well-imagined, gripping story covering so many themes and narratives that weave around each other so tightly that there’s no way to just mention a part. An incredible read.</li>
</ul>

<p>And that’s it for 2008. Hope we have as much fun making up the 2009 awards, and you all have a good year. Keep your eyes peeled for Fichtner though, he’s hard to spot.</p>

  </div>
  <div class="divider"><img src="/solitude-jekyll/assets/images/divider.png" /></div>
  </div>
  
</div>



<!-- Pagination links -->
<div class="postnavigation">
  
    <a href="/page/39" class="previous">&laquo; Previous</a>
  
  
    <a href="/page/41" class="next">Next &raquo;</a>
  
</div>


      <div class="footer">
        <div class="disclaimer">
  

  <p>
    © Solitude, 2003-20 &mdash; built with <a href="http://jekyllrb.com/">Jekyll</a>, using <a href="https://github.com/swanson/lagom">Lagom</a> as a base theme.
  </p>
</div>
      </div>
    </div>
  </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11493178-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
